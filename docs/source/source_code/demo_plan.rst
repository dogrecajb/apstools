
Demonstrate ``nscan`` and ``TuneAxis``
--------------------------------------

.. FIXME: very rough, raw demo until this code can work
   .. currentmodule:: demo_plan
   
   .. automodule:: APS_BlueSky_tools.demo_plan
      :members:
      :undoc-members:

.. literalinclude:: ../../../APS_BlueSky_tools/demo_plan.py
   :language: python
   :linenos:


output from :func:`demo_TuneAxis`
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. code-block:: pycon

   Loading metadata history from /home/mintadmin/.config/bluesky/bluesky_history.db
   spvoigt.scale:  100000.0
   spvoigt.center:  -1.4910027475019858
   spvoigt.sigma:  0.035867168639114114
   spvoigt.eta:  0.274478257770014
   spvoigt.bkg:  0.009072591644989138
   +-----------+------------+------------+------------+
   |   seq_num |       time |         m1 |    spvoigt |
   +-----------+------------+------------+------------+
   |         1 | 22:53:11.4 |   -2.50000 |    941.899 |
   |         2 | 22:53:11.9 |   -2.28000 |    963.864 |
   |         3 | 22:53:12.4 |   -2.06000 |   1015.892 |
   |         4 | 22:53:12.9 |   -1.83000 |   1211.120 |
   |         5 | 22:53:13.4 |   -1.61000 |   3488.621 |
   |         6 | 22:53:13.9 |   -1.39000 |   5357.115 |
   |         7 | 22:53:14.4 |   -1.17000 |   1245.710 |
   |         8 | 22:53:14.9 |   -0.94000 |   1023.072 |
   |         9 | 22:53:15.4 |   -0.72000 |    966.531 |
   |        10 | 22:53:15.9 |   -0.50000 |    943.167 |
   +-----------+------------+------------+------------+
   generator TuneAxis.multi_pass_tune ['9c2d8735'] (scan num: 1123)
   x : m1
   y : spvoigt
   cen : -1.4573144989321931
   com : -1.4869320085354596
   fwhm : 0.37088586523910627
   min : [  -2.5         941.89883376]
   max : [ -1.39000000e+00   5.35711504e+03]
   crossings : [-1.64275743 -1.27187157]
   tune_ok : True
   center : -1.4573144989321931
   initial_position : -1.5
   final_position : -1.4573144989321931
   +-----------+------------+------------+------------+
   |   seq_num |       time |         m1 |    spvoigt |
   +-----------+------------+------------+------------+
   |         1 | 22:53:17.7 |   -1.21000 |   1347.269 |
   |         2 | 22:53:18.0 |   -1.27000 |   1611.654 |
   |         3 | 22:53:18.3 |   -1.32000 |   2064.740 |
   |         4 | 22:53:18.6 |   -1.38000 |   4105.771 |
   |         5 | 22:53:18.9 |   -1.43000 |  25039.094 |
   |         6 | 22:53:19.2 |   -1.49000 | 100857.474 |
   |         7 | 22:53:19.5 |   -1.54000 |  39021.443 |
   |         8 | 22:53:19.8 |   -1.60000 |   4305.651 |
   |         9 | 22:53:20.1 |   -1.65000 |   2240.308 |
   |        10 | 22:53:20.4 |   -1.71000 |   1624.276 |
   +-----------+------------+------------+------------+
   generator TuneAxis.multi_pass_tune ['099a1882'] (scan num: 1124)
   x : m1
   y : spvoigt
   cen : -1.49042852135927
   com : -1.4922563548034637
   fwhm : 0.07960591978251985
   min : [ -1.21000000e+00   1.34726914e+03]
   max : [ -1.49000000e+00   1.00857474e+05]
   crossings : [-1.45062556 -1.53023148]
   tune_ok : True
   center : -1.49042852135927
   initial_position : -1.46
   final_position : -1.49042852135927
   +-----------+------------+------------+------------+
   |   seq_num |       time |         m1 |    spvoigt |
   +-----------+------------+------------+------------+
   |         1 | 22:53:21.4 |   -1.55000 |  27069.824 |
   |         2 | 22:53:21.5 |   -1.54000 |  39021.443 |
   |         3 | 22:53:21.7 |   -1.52000 |  69832.340 |
   |         4 | 22:53:21.9 |   -1.51000 |  85398.863 |
   |         5 | 22:53:22.1 |   -1.50000 |  97035.194 |
   |         6 | 22:53:22.3 |   -1.48000 |  95211.810 |
   |         7 | 22:53:22.5 |   -1.47000 |  82467.846 |
   |         8 | 22:53:22.7 |   -1.46000 |  66552.850 |
   |         9 | 22:53:22.9 |   -1.44000 |  36387.505 |
   |        10 | 22:53:23.1 |   -1.43000 |  25039.094 |
   +-----------+------------+------------+------------+
   generator TuneAxis.multi_pass_tune ['98c92dd2'] (scan num: 1125)
   x : m1
   y : spvoigt
   cen : -1.491026082402773
   com : -1.4910212549897381
   fwhm : 0.0693661280568838
   min : [ -1.43000000e+00   2.50390940e+04]
   max : [ -1.50000000e+00   9.70351942e+04]
   crossings : [-1.52570915 -1.45634302]
   tune_ok : False
   center : -1.49042852135927
   initial_position : -1.49
   final_position : -1.49
   final:  -1.49042852136
   max (-1.5, 97035.194167002599)
   min (-1.4299999999999999, 25039.0940055141)
   -- -1.45731449893 0.370885865239
   -- -1.49042852136 0.0796059197825
   -- -1.4910260824 0.0693661280569
   m1= -1.49  det= 25039.0940055
   
   ########################################
   # repeat but with only one pass
   
   +-----------+------------+------------+------------+
   |   seq_num |       time |         m1 |    spvoigt |
   +-----------+------------+------------+------------+
   |         1 | 22:53:25.0 |   -2.50000 |    941.899 |
   |         2 | 22:53:25.2 |   -2.43000 |    947.248 |
   |         3 | 22:53:25.5 |   -2.36000 |    953.939 |
   |         4 | 22:53:25.8 |   -2.29000 |    962.459 |
   |         5 | 22:53:26.1 |   -2.22000 |    973.542 |
   |         6 | 22:53:26.4 |   -2.16000 |    985.929 |
   |         7 | 22:53:26.7 |   -2.09000 |   1005.321 |
   |         8 | 22:53:27.0 |   -2.02000 |   1032.863 |
   |         9 | 22:53:27.3 |   -1.95000 |   1073.845 |
   |        10 | 22:53:27.6 |   -1.88000 |   1138.643 |
   |        11 | 22:53:28.0 |   -1.81000 |   1249.926 |
   |        12 | 22:53:28.3 |   -1.74000 |   1465.207 |
   |        13 | 22:53:28.6 |   -1.67000 |   1967.072 |
   |        14 | 22:53:28.9 |   -1.60000 |   4305.651 |
   |        15 | 22:53:29.2 |   -1.53000 |  53659.951 |
   |        16 | 22:53:29.5 |   -1.47000 |  82467.846 |
   |        17 | 22:53:29.8 |   -1.40000 |   7500.245 |
   |        18 | 22:53:30.1 |   -1.33000 |   2208.092 |
   |        19 | 22:53:30.4 |   -1.26000 |   1553.393 |
   |        20 | 22:53:30.7 |   -1.19000 |   1291.531 |
   |        21 | 22:53:31.0 |   -1.12000 |   1161.419 |
   |        22 | 22:53:31.3 |   -1.05000 |   1087.626 |
   |        23 | 22:53:31.6 |   -0.98000 |   1041.821 |
   |        24 | 22:53:31.9 |   -0.91000 |   1011.465 |
   |        25 | 22:53:32.2 |   -0.84000 |    990.325 |
   |        26 | 22:53:32.5 |   -0.78000 |    976.931 |
   |        27 | 22:53:32.8 |   -0.71000 |    965.026 |
   |        28 | 22:53:33.1 |   -0.64000 |    955.930 |
   |        29 | 22:53:33.4 |   -0.57000 |    948.824 |
   |        30 | 22:53:33.7 |   -0.50000 |    943.167 |
   +-----------+------------+------------+------------+
   generator TuneAxis.tune ['61cfbe3b'] (scan num: 1126)
   x : m1
   y : spvoigt
   cen : -1.4894470984335977
   com : -1.4929796022669355
   fwhm : 0.1150179655778798
   min : [  -2.5         941.89883376]
   max : [ -1.47000000e+00   8.24678458e+04]
   crossings : [-1.54695608 -1.43193812]
   tune_ok : True
   center : -1.4894470984335977
   initial_position : -1.5
   final_position : -1.4894470984335977
   final:  -1.48944709843
   max (-1.47, 82467.845751467088)
   min (-2.5, 941.89883375677323)
   centroid -1.48944709843
   FWHM 0.115017965578
   m1= -1.49  det= 943.166559768


output from :func:`demo_nscan`
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. code-block:: pycon

   +-----------+------------+------------+------------+------------+
   |   seq_num |       time |         m1 |         m2 |  noisy_val |
   +-----------+------------+------------+------------+------------+
   |         1 | 23:11:17.3 |   -1.00000 |   -2.00000 |    0.15099 |
   |         2 | 23:11:17.9 |   -0.80000 |   -1.60000 |    0.55322 |
   |         3 | 23:11:18.7 |   -0.60000 |   -1.20000 |    0.83030 |
   |         4 | 23:11:19.3 |   -0.40000 |   -0.80000 |    0.62026 |
   |         5 | 23:11:20.0 |   -0.20000 |   -0.40000 |    0.46387 |
   |         6 | 23:11:20.8 |    0.00000 |    0.00000 |    0.06889 |
   +-----------+------------+------------+------------+------------+
   generator nscan ['d0b6ac4a'] (scan num: 1127)
